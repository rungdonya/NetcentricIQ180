<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Netcentric</title>
    <link rel="stylesheet" href="http://www.w3schools.com/lib/w3.css">
    <link rel="stylesheet" href="http://www.w3schools.com/lib/w3-theme-black.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
    <link href="https://fonts.googleapis.com/css?family=Life+Savers" rel="stylesheet">
    <link rel="stylesheet" href="/lib/w3-theme-blue-grey.css">
    <link rel="stylesheet" href="style.css">
    <!--embed src="themesong.mp3" width="0" height="0" loop="true" autostart="true"></embed-->
    <script src="http://www.w3schools.com/lib/w3data.js"></script>

</head>

<body>

<!--First page-->
<div class="ex">
    <header class="w3-container w3-padding-32 w3-center  w3-margin-bottom">
        <!--<div id="includedContent1"></div>
        เดี๋ยวแก้ให้อีกที มีปัญหาอยู่
        -->
        <h3><b>IQ180</b></h3>
        <p><b>INSERT YOUR NAME</b></p>
        <input id="username" type="text" placeholder="Please insert your name" >
        <button class="hide" id="play"></button>
    </header>
</div>

<!--CHAT-->
<div class="ex2">
    <header class="w3-container w3-padding-32 w3-center w3-opacity w3-margin-bottom">
        <h2>CHAT ROOM</h2>
        <div>
        </div>

        <div id="wrapper">
            <div id="menu">
                <p class='welcome' id="WelcomeUser"><b></b></p>
                <p class="logout"><a id="exit" href="#">Exit Chat</a></p>
                <div style="clear:both"></div>
            </div>

            <div id="chatbox"></div>
            <div id="listofplayer"></div>
            <form name="message" action="">
                <input name="usermsg" type="text" id="usermsg" size="63" />
                <input name="submitmsg" type="submit"  id="submitmsg" value="Send" />
            </form>
            <button class="hide" id="play"></button>
        </div>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
        <script type="text/javascript">
            // jQuery Document
            $(document).ready(function(){
            });
        </script>
</div>

<!--MODE-->
<div class="ex3">
<header class="w3-container w3-padding-32 w3-center w3-opacity w3-margin-bottom">
    <h1>Welcome,</h1>
    <h2>MODE</h2>
    <div>
        <a href="javascript:void(0)" class="w3-btn w3-btn-block w3-hover-blue-grey w3-padding-16">Single Player</a>
        <a href="javascript:void(0)" class="w3-btn w3-btn-block w3-hover-teal w3-padding-16" id='multi'>Multi Player</a>
        <!--time counter for challenging-->
        <a id="cha" class="w3-btn w3-btn-block w3-hover-light-blue w3-padding-16"> Challenging</a>
        <button class="hide" id="play"></button>
    </div>

</header>
</div>

<!--LEVEL-->
<div class="ex4">
<header class="w3-container w3-padding-32 w3-center w3-opacity w3-margin-bottom">
    <h1>Welcome,</h1>
    <h2>LEVEL</h2>
    <div>
        <a href="javascript:void(0)" class="w3-btn w3-btn-block w3-hover-blue-grey w3-padding-16">Easy</a>
        <a href="javascript:void(0)" class="w3-btn w3-btn-block w3-hover-teal w3-padding-16">Medium</a>
        <a href="javascript:void(0)" class="w3-btn w3-btn-block w3-hover-light-blue w3-padding-16">Hard</a>
        <button class="hide" id="play"></button>
    </div>

</header>
</div>

<!--LOADING-->
<div class="ex5">
    <header class="w3-container w3-padding-32 w3-center w3-margin-bottom">
        <img src="04de2e31234507.564a1d23645bf.gif">
        <h2> Wait for your opponent</h2>

    </header>

</div>

<!-- If player chooses Challenge-->
<div class="exCha">
    <header>
        <button onClick="myTimer = setInterval(counterkaaacounter, 1000)">Start counter!</button>
        <p id="demo">0</p>
        <button onClick="clearInterval(myTimer)">Stop counter!</button>
    </header>
</div>

<!-- GAME -->
<div class="ex6">
    <div class="w3-container w3-padding-32 w3-center w3-margin-bottom" class="ex6header">
        <div class="w3-col s4 w3-center " id="player1">
            <div class="w3-container w3-theme" id="player1name">
                <h4 id="p1name">PLAYER1'S NAME</h4>
            </div>

            <div class="w3-container w3-text-theme" id="player1score">
                <h5>0</h5></div>
        </div>

        <div class="w3-col s4 w3-center" class="clock" id="clockdiv">
            <h6>Remaining Time:</h6>
            <div>
                <span class="minutes"></span>
                <div class="smalltext">Minutes</div>
            </div>
            <div>
                <span class="seconds"></span>
                <div class="smalltext">Seconds</div>
            </div><br>
        </div>

        <div class="w3-col s4 w3-center " id="player2">
            <div class="w3-container w3-theme" id="player2name">
                <h4 id="p2name">PLAYER2'S NAME</h4>
            </div>

            <div class="w3-container w3-text-theme" id="player2score">
                <h5>0</h5></div>
        </div>

    </div>
    <!button id="p" class="start" onclick="start(),starttime()">START<!/button>

    <div id="includedContent2"></div>

</div>


<!--Winnerrr-->
<div class="ex7">
    <header class="w3-container w3-padding-32 w3-center w3-opacity w3-margin-bottom">
        <h2>The WINNER is</h2>
        <h2 id = 'winnerName'>WINNER'S NAME</h2>
        <h2 id="winnerScore">Score :</h2>
        <button id="replay" class="replay""></button>
        <button id="quit" class="quit"></button>



    </header>
</div>

        <script src="timer.js"></script>

    </header>

</div>


</body>

    </header>

</div>

</body>

</html>

<script src="index.js"></script>

<script src="http://code.jquery.com/jquery-latest.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script src="http://www.w3schools.com/jquery/jquery_ref_effects.asp"></script>

<script>
    var socket = io.connect();
    var $username = $('#username');
    var $name = $('');
    var $listofplayer = $('#listofplayer');
    var $error = $('#error');
    //var $room = $('#room');
    var $WelcomeUser = $('#WelcomeUser');
    var $submitmsg = $('#submitmsg');
    var $usermsg = $('#usermsg');
    var $chatbox = $('#chatbox');
    var $multi = $('#multi'); var checkans = $('#checkans');
    var correct =false;
    var p1name = $('#p1name'),player1score = $('#player1score');
    var p2name = $('#p2name'),player2score = $('#player2score');
    var winnerName = $('#winnerName'), winnerScore = $('#winnerScore');
    var quit = $('#quit'),replay=$('#replay');
    var player1id,player2id, rooms,firstCorrect,secondCorrect;
    var firstTime,secondTime,roomno,winner,loser,winningScore,losingScore;

    //page 1
    $(document).ready(function(){
        $(".ex2").hide();
        $(".ex3").hide();
        $(".ex4").hide();
        $(".ex5").hide();
        $(".ex6").hide();
        $(".ex7").hide();
        $(".exCha").hide();


        $(".ex .hide").click(function() {
            socket.emit('send username', $username.val(), function (data) {  //send username + detect duplicate user
                if (!data) {
                    $error.html("duplicate username");
                    window.alert("duplicate user");
                } else {
                    $error.hide();
                    $(".ex").hide("slow");
                    $(".ex2").show();
                }
            })
        });
    });
    socket.on('welcomeuser',function(data){
        console.log(data);
        $WelcomeUser.html(data);
        socket.on('broadcast',function (data) {
            console.log(data);
            $chatbox.append('<i>'+ data +'<br/>');
        })
    });
    $submitmsg.click(function(e) {
                e.preventDefault();
                socket.emit('send msg', $usermsg.val());
                $usermsg.val(' ');
            }
    );
    socket.on('new msg',function (data) {
        $chatbox.append('<b>' + data.nick + ':</b>' + data.msg + "<br/>");
        console.log(data.nick);
    })
    socket.on('listOfUser',function (data) {   //add list of online user
        var list = 'Online :<br/>';
        for(i=0;i<data.length;i++){
            list += data[i]+ '<br/>'
        }
        $listofplayer.html(list);
    });

    //chat page
    $(".ex2 .hide").click(function(){
        $(this).parents(".ex2").hide("slow");
        $(".ex3").show();
    });

    //game
    $(".ex3 .hide").click(function(){
        $(this).parents(".ex3").hide("slow");
        $(".ex4").show();
    });

    $multi.click(function(){
        console.log('multiplayer mode');
        socket.emit('pair');
    });

    //one opponent obtain this page
    var turn;
    var roomNum,originalProb,originalAns;

    socket.on('connectToRoom',function(data){
        $(".ex3").hide("slow");
        $(".ex7").hide("slow");
        console.log(data.username);
        console.log(data.opponent);

        rooms = data.rooms;
        roomNum= data.room;
        originalProb = data.num;
        originalAns = data.sum;
        turn = data.turn;

        resetTime();

        if(data.playturn){
            $(".ex6").show();
            //random problem
            p1name.html(data.username);
            p2name.html(data.opponent);

            start(data);starttime();

        }else{
            $(".ex5").show();
        }
    });

    socket.on('play', function(data){

        turn = data.turn;
        rooms = data.rooms
        firstCorrect = data.firstCorrect;
        secondCorrect = data.secondCorrect
        firstTime =  data.firstTime;
        resetTime();

        if(data.playturn){
            $(".ex5").hide("slow");
            console.log('player: '+data.username);
            console.log('opponent: '+data.opponent);

            $(".ex6").show();
            //random problem
            p1name.html(data.username);
            p2name.html(data.opponent);
            start(data);starttime();
        }else{
            $(".ex6").hide("slow");
            $(".ex5").show();
            console.log('Wait for your opponent.... ');
        }
    });



    socket.on('conclusion', function(data){
        $(".ex6").hide("slow");
        $(".ex5").hide("slow");
        $(".ex7").show();

        winner = data.winner;
        loser = data.loser;
        winningScore = data.winningScore;
        losingScore = data.losingScore;

        winnerName.html(winner);
        winnerScore.html('Score : '+data.firstScore + ' to '+data.secondScore);
        roomno = data.roomno;

        quit.click(function(){
            socket.emit('reset',{room:roomno,firstid:data.firstid, secondid:data.secondid});
        });

        socket.on('back',function(data){
            //if(data.room == null){
            $(".ex7").hide("slow");
            $(".ex2").show();
            // }
            //  console.log('back to chat');
        });

        replay.click(function(data){
            socket.emit('continue',{room:roomNum, winner:winner,loser:loser,
                winningScore:winningScore,losingScore:losingScore,rooms:rooms });
        })

    })
    /* room: roomno, firstName: rooms[roomno].first["name"], secondName: rooms[roomno].second["name"],
     firstScore: rooms[roomno].first["score"], secondScore: rooms[roomno].second["score"]*/



    $("#cha").click(function(){
        $(this).parents(".ex3").hide("slow");
        $(".exCha").show();
    });

    $(".ex4 .hide").click(function(){
        $(this).parents(".ex4").hide("slow");
        $(".ex5").show();
    });


    $(".ex5 .hide").click(function(){
        $(this).parents(".ex5").hide("slow");
        $(".ex6").show();
    });



    $(".ex6 .hide").click(function(){
        $(this).parents(".ex6").hide("slow");
        $(".ex7").show();

    });

    var time, score;

    $("#p").click(function(){
        $("#p").hide();
    });

    $(function(){
        $("#includedContent1").load("firstpage.html");
    });
    $(function(){
        $("#includedContent2").load("calculate.html");
    });


   //firstTime == time of first player
    function check(){
        var input = document.getElementById("ans").value;
        var num=0;
        var correct;

        console.log(input);
        var inputarray =[];
        socket.emit('isclick');

        for(i=0;i<input.length;i++){
            inputarray[i]=input.substring(i,i+1);
            if(inputarray[i].localeCompare(document.getElementById("num1").innerHTML)==0||
                    inputarray[i].localeCompare(document.getElementById("num2").innerHTML)==0||
                    inputarray[i].localeCompare(document.getElementById("num3").innerHTML)==0||
                    inputarray[i].localeCompare(document.getElementById("num4").innerHTML)==0||
                    inputarray[i].localeCompare(document.getElementById("num5").innerHTML)==0){
                num++;
            }
        }
        console.log(num)
        if(num<5){
            alert("Please use all the values we given!!")
            correct=false;
            //return false;
        }else if(num==5){
            if(eval(input)==document.getElementById("realans").innerHTML){
                //   alert("CORRECT!!!")
               correct=true;
                // data = true;

                //turn = 1 ==> second player turn, turn = 0 ==> first player turn
                if(turn==1) {
                    //sencond player time
                    secondTime = stoptime();
                    secondCorrect = 1;
                    console.log(secondTime);
                    socket.emit('done', {room: roomNum, firstTime:firstTime, secondTime: secondTime, firstCorrect : firstCorrect,
                         secondCorrect: secondCorrect, rooms:rooms});
                    console.log(firstCorrect+'&'+secondCorrect);
                    alert("Congratulation!!! You've solved the equation in"+secondTime+"sec");

                }else if(turn ==0){
                    //first player time
                    firstTime = stoptime();
                    console.log(firstTime);
                    firstCorrect= 1;
                    secondCorrect=0;
                    socket.emit('showit',
                            {room: roomNum, firstTime: firstTime, sum: originalAns,
                                num: originalProb,firstCorrect : firstCorrect,firstTime :firstTime,
                                secondCorrect: secondCorrect,rooms:rooms});
                    // , score: score ==> didn't use this
                    console.log(firstCorrect+'&&&&'+secondCorrect);

                    alert("Congratulation!!! You've solved the equation in"+firstTime+"sec");
                }
                // socket.emit('showit');
            }else{
                alert("WRONG!!!")
            }
        }else if(num>5){
            alert("Please use each value once!!")
            //return false;
            correct=false;
        }

    }



    function backtogame(){


      //  $(".ex7").hide("slow");
      //  $(".ex6").show();

    }

    function backtofirstpage(){
        $(".ex7").hide("slow");
        $(".ex").show();
    }

</script>



</body>
</html>